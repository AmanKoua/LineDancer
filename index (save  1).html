<!-- python -m http.server 8000 -->

<!DOCTYPE html>
<html>

    <body>
        <canvas id="canvas" style="border: 3px solid black"></canvas>
        <img src="./person.jpg" id="img" style="visibility:hidden"/>
        <!-- width: 1300px; height: 600px; -->
    </body>
    <script>

        let canvas = document.getElementById("canvas");
        canvas.width = 1300;
        canvas.height = 600;
        ctx = canvas.getContext("2d");

        let time = 0;
        let distTresh = 100;
        let distTreshMult = 255 / distTresh;
        let dots = [];
        let rect;

        let img = document.getElementById("img");

        // let mouseX;
        // let mouseY;

        // window.onmousemove = (e) => {
        //     mouseX = e.clientX;
        //     mouseY = e.clientY;
        //     let colorData = ctx.getImageData(mouseX,mouseY, 1, 1);
        //     console.log(colorData.data[0],colorData.data[1],colorData.data[2],colorData.data[3]);
        // }

        class Rect{
            constructor(x,y,xEnd,yEnd){
                this.x = x;
                this.y = y;
                this.xEnd = xEnd;
                this.yEnd = yEnd;
            }

            isInRect(x,y){
                if(x < this.x || x > this.xEnd){
                    return false;
                }

                if(y < this.y || y > this.yEnd){
                    return false;
                }

                return true;
            }

            draw(){
                ctx.beginPath();
                ctx.rect(this.x, this.y, this.xEnd - this.x, this.yEnd - this.y);
                ctx.stroke();
            }

        }

        class Dot {
            constructor(x,y){
                this.x = x;
                this.y = y;
                this.r = 2;
                this.xMov = Math.random() *2;
                this.yMov = Math.random() *2;
            }

            updatePos(canvas){
                this.x += this.xMov;
                this.y += this.yMov;

                if(this.x > canvas.width || this.x < 0){
                    this.xMov *= -1;
                }

                if(this.y > canvas.height || this.y < 0){
                    this.yMov *= -1;
                }

            }

            getDist(other){
                return Math.sqrt(Math.pow((this.x - other.x),2) + Math.pow((this.y - other.y),2));
            }

            getIsValidCoor(){
                let colorData = ctx.getImageData(this.x,this.y, 1, 1);

                if(colorData[3] == 0){ // if not in image boundary
                    return false;
                }

                if(colorData[0] + colorData[1] + colorData[2] < 10){ // if black or very dark pixel
                    return true;
                }

                return false;
            }   

            drawLines(){
                for(let i = 0; i < dots.length; i++){
                    let tempDist = this.getDist(dots[i])
                    // if(tempDist < (Math.sin(time) * distTresh)){
                    if(tempDist < (distTresh)){
                        // if(rect.isInRect(this.x, this.y) && rect.isInRect(dots[i].x, dots[i].y)){
                            ctx.beginPath();
                            ctx.moveTo(this.x,this.y);
                            ctx.lineTo(dots[i].x, dots[i].y);
                            ctx.lineWidth = 1;
                            // ctx.strokeStyle = `rgb(${255 - tempDist*distTreshMult}, 0, ${tempDist})`
                            ctx.stroke();
                        // }
                    }
                }
            }

        };

        let initDots = (count) => {
            for(let i = 0; i < count; i++){
                let temp = new Dot(Math.random() * (canvas.width-50), Math.random() * (canvas.height - 50));
                dots.push(temp);
            }
        }

        let drawDot = (canvas,ctx, dot) => {
			ctx.beginPath();
            ctx.arc(dot.x, dot.y, dot.r, 0, 2 * Math.PI);
            ctx.fill();
            dot.updatePos(canvas);
            ctx.lineWidth = 1;
            ctx.strokeStyle = "rgb(0,0,0)"
            ctx.stroke();
            dot.drawLines();
        }

        let draw = () => {

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // rect.draw();

            for(let i = 0 ; i < dots.length; i++){
                drawDot(canvas,ctx,dots[i]);
            }

            ctx.globalAlpha = 0.2; // set image opacity
            ctx.drawImage(img, 500,10, 500, 500)
            ctx.globalAlpha = 1;
        
            // ctx.beginPath(); // Start a new path
			// ctx.moveTo(15, 15); // Move the pen to (30, 50)
			// ctx.lineTo(200 ,200); // Draw a line to (150, 100)
            time += .1;
            requestAnimationFrame(draw);

        }

        initDots(100);
        // rect = new Rect(500, 250, 700, 450);
        draw();

    </script>

</html>